<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<style>
		*{
			padding: 0;
			margin: 0;
		}
		img{
			display: block;
			width: 200px;
			border: 0;
		}

		.container{
			position: relative;
		}
		.imgShow{
			position: absolute;
			float: left;
			border:solid 1px #ccc;
			padding:10px;
			border-radius: 4px;
			box-shadow: 5px 5px 5px #ccc;
			-webkit-transition: all .7s ease-out .1s;
		    -moz-transition: all .7s ease-out .1s;
		    -o-transition: all .7s ease-out .1s;
		    /*transition: all .7s ease-out .1s;*/
		    transition: all .7s cubic-bezier(0.18, 0.89, 0.32, 1.28) .1s;
		}

	#loading{
	  background-color: #bd4932;
	  height: 100%;
	  width: 100%;
	  position: fixed;
	  z-index: 1;
	  margin-top: 0px;
	  top: 0px;
	}          
	#loading-center{
	  width: 100%;
	  height: 100%;
	  position: relative;
	}
	#loading-center-absolute {
	  position: absolute;
	  left: 50%;
	  top: 50%;
	  height: 200px;
	  width: 200px;
	  margin-top: -100px;
	  margin-left: -100px;
	}
	#object{
	  width: 80px;
	  height: 80px;
	  background-color: #FFF;
	  -webkit-animation: animate 1s infinite ease-in-out;
	  animation: animate 1s infinite ease-in-out;
	  margin-right: auto;
	  margin-left: auto;
	  margin-top: 60px;
	}
	@-webkit-keyframes animate {
	  0% { -webkit-transform: perspective(160px); }
	  50% { -webkit-transform: perspective(160px) rotateY(-180deg); }
	  100% { -webkit-transform: perspective(160px) rotateY(-180deg) rotateX(-180deg); }
	}
	  
	@keyframes animate {
	  0% { 
	    transform: perspective(160px) rotateX(0deg) rotateY(0deg);
	    -webkit-transform: perspective(160px) rotateX(0deg) rotateY(0deg); 
	  } 50% { 
	    transform: perspective(160px) rotateX(-180deg) rotateY(0deg);
	    -webkit-transform: perspective(160px) rotateX(-180deg) rotateY(0deg) ;
	  } 100% { 
	    transform: perspective(160px) rotateX(-180deg) rotateY(-180deg);
	    -webkit-transform: perspective(160px) rotateX(-180deg) rotateY(-180deg);
	  }
	}  

	</style>
</head>
<body>
	<div class="container">
		<div class="imgShow" ><a href="./images/temp_img02.jpg"><img src="./images/temp_img02.jpg"></a></div>
		<div class="imgShow" ><a href="./images/temp_img03.jpg"><img src="./images/temp_img03.jpg"></a></div>
		<div class="imgShow" ><a href="./images/temp_img04.jpg"><img src="./images/temp_img04.jpg"></a></div>
		<div class="imgShow" ><a href="./images/temp_img05.jpg"><img src="./images/temp_img05.jpg"></a></div>
		<div class="imgShow" ><a href="./images/temp_img06.jpg"><img src="./images/temp_img06.jpg"></a></div>
		<div class="imgShow" ><a href="./images/temp_img07.jpg"><img src="./images/temp_img07.jpg"></a></div>
		<div class="imgShow" ><a href="./images/temp_img08.jpg"><img src="./images/temp_img08.jpg"></a></div>
		<div class="imgShow" ><a href="./images/temp_img09.jpg"><img src="./images/temp_img09.jpg"></a></div>
		<div class="imgShow" ><a href="./images/temp_img10.jpg"><img src="./images/temp_img10.jpg"></a></div>
		<div class="imgShow" ><a href="./images/temp_img11.jpg"><img src="./images/temp_img11.jpg"></a></div>
		<div class="imgShow" ><a href="./images/temp_img12.jpg"><img src="./images/temp_img12.jpg"></a></div>
		<div class="imgShow" ><a href="./images/temp_img13.jpg"><img src="./images/temp_img13.jpg"></a></div>
		<div class="imgShow" ><a href="./images/temp_img15.jpg"><img src="./images/temp_img15.jpg"></a></div>
	</div>
	<div id="loading">
	  <div id="loading-center">
	    <div id="loading-center-absolute">
	      <div id="object"></div>
	    </div>
	  </div>
	</div>   
<script src="js/jquery-1.8.3.min.js"></script>
<script>
(function(){

	document.documentElement.style.overflowY = 'hidden';
	$('img').load(function() {
	   $("#loading").fadeOut(500, function(){
	   		 $(this).remove();
	   		 document.documentElement.style.overflowY = 'visible';
	   });
	 
	})

function WaterFall(){
	var _this = this;
	this.margin = 10;
	this.items = $('.imgShow');
	this.container = $('.container');
	this.singleItemWidth = this.items[0].offsetWidth + this.margin;

	var dataInt={
        'data':[{'src':'temp_img06.jpg'},{'src':'temp_img12.jpg'},{'src':'temp_img15.jpg'},{'src':'temp_img03.jpg'}]
    };

	
	$("img").load(function(){
		_this.init();

		$(window).resize(function(event) {
			setTimeout(function(){
				_this.init();
			}, 500);
			
		});

		$(document).scroll(function(event) {
			if(_this.checkscrollside()){
				//	执行数据加载
				for(var i = 0; i < dataInt.data.length; i++){
					var imgShow = document.createElement('div');
					imgShow.className = 'imgShow';
					var aEl = document.createElement('a');
					imgShow.appendChild(aEl);
					var img = document.createElement('img');
					img.src = './images/' + dataInt.data[i].src;
					aEl.appendChild(img);
					_this.container[0].appendChild(imgShow);

					$(imgShow).css('opacity', "0");
					$(imgShow).stop().animate({
				        "opacity":"1"
				    }, 300);
				}

				//	更新元素数量
				_this.items = $('.imgShow');
				_this.init();
			}
		});
	});

}
WaterFall.prototype = {
	init : function(){
		var itemHeightArray = [];
		var colMaxNumber = Math.floor($(window).width() / this.singleItemWidth);
		//	将包裹层居中显示
		if($(window).width() > this.singleItemWidth){
			this.container.css('left', ($(window).width() - (colMaxNumber * this.singleItemWidth)) / 2);
		}
		for(var i = 0; i < this.items.length; i++){
			if(i < colMaxNumber){
				itemHeightArray[i] = this.items[i].offsetHeight + this.margin;
				this.items[i].style.top = 0;
				this.items[i].style.left = i * this.singleItemWidth + 'px';
			}else{
				var minHeight = Math.min.apply(null, itemHeightArray);
				var minHeightIndex = $.inArray(minHeight, itemHeightArray);
	
				this.items[i].style.top = minHeight + 'px';
				// this.items[i].style.left = this.items[minHeightIndex].offsetLeft + 'px';
				this.items[i].style.left = minHeightIndex * this.singleItemWidth + 'px';
				itemHeightArray[minHeightIndex] += this.items[i].offsetHeight + this.margin;
	

				// //	取出数组中最小高度的下标
				// var innsertColumn = this.min(itemHeightArray);
				// //	当前要放置的元素的高度加上边距
				// var imgHeight = this.items[i].offsetHeight + this.margin;

				// this.items[i].style.top = itemHeightArray[innsertColumn] + 'px';
				// this.items[i].style.left = innsertColumn * this.singleItemWidth + 'px';
				// itemHeightArray[innsertColumn] += imgHeight;
			}	

		}
	},
	min : function(heightAarry){
		var minColumn = 0;
		var minHeight = heightAarry[minColumn];
		for (var i = 1,len=heightAarry.length; i < len; i++) {
			var temp = heightAarry[i];
			if (temp < minHeight) {
				minColumn = i;
				minHeight = temp;
			};
		};
		return minColumn;
	},
	checkscrollside : function(){
		//	视口高度
		var widnowHeight = document.documentElement.clientHeight;
		//	滚动条距离文档顶部的高度
		var scrollHeight = document.documentElement.scrollTop || document.body.scrollTop;
		var lastElement = $(this.items[this.items.length - 1]);
		return (widnowHeight + scrollHeight) > (lastElement.offset().top + lastElement.height() / 2);
	}
};




new WaterFall();
















})();






</script>
</body>
</html>